# Facility Definition Example
# This file demonstrates a complete base facility with services, costs, and effects

[[facility]]
id = "advanced_laboratory"
name = "Advanced Laboratory"
description = "State-of-the-art research facility with enhanced equipment for studying alien technology."

# Facility classification
category = "research"         # research, manufacturing, defense, support, power, storage
type = "laboratory"          # Specific facility type
tier = 2                     # 1=basic, 2=advanced, 3=experimental

# Grid placement (facilities use basescape grid)
[facility.grid]
width = 2                    # Tiles wide (in basescape grid)
height = 2                   # Tiles tall
placement_rules = "ground"   # ground, underground, any
adjacent_required = []       # No specific adjacency requirements
adjacent_forbidden = ["power_generator"]  # Can't be next to generators (interference)

# Construction costs
[facility.construction]
cost_credits = 75000
cost_materials = [
    { item = "alien_alloys", quantity = 20 },
    { item = "advanced_components", quantity = 10 }
]
construction_days = 14       # Days to build
engineer_hours = 200         # Engineer-hours required (parallel with days)

# Prerequisites
[facility.prerequisites]
research_required = ["alien_materials", "advanced_physics"]
facility_required = ["basic_laboratory"]  # Must have built this first
min_game_month = 3           # Cannot build before month 3
base_size_min = "medium"     # Requires medium-sized base

# Maintenance costs
[facility.maintenance]
daily_cost = 500             # Credits per day
power_consumption = 15       # Power units required
staff_required = 0           # No dedicated staff (scientists work here)

# Services provided
[[facility.services]]
service_type = "research"
capacity = 12                # Can accommodate 12 scientists
efficiency_bonus = 0.25      # 25% faster research speed
specialization = ["physics", "alien_tech"]  # Bonus for these research types

[[facility.services]]
service_type = "containment"
capacity = 5                 # Can safely contain 5 alien specimens
security_level = "high"      # Prevents escapes

# Passive bonuses
[facility.bonuses]
research_speed_global = 0.10     # All research in base gets +10% speed
scientist_morale = 5             # Scientists happier in advanced facilities
breakthrough_chance = 0.05       # 5% bonus chance for research breakthroughs

# Upgrades
[[facility.upgrades]]
upgrade_id = "quantum_computers"
name = "Quantum Computing Core"
cost_credits = 30000
cost_materials = [{ item = "quantum_processor", quantity = 5 }]
research_required = "quantum_computing"
effect = { efficiency_bonus = 0.15 }  # Additional 15% bonus
construction_days = 7

[[facility.upgrades]]
upgrade_id = "alien_containment_cells"
name = "Enhanced Containment"
cost_credits = 20000
research_required = "alien_biology"
effect = { containment_capacity = 5 }  # +5 containment slots
construction_days = 5

# Defense properties (if base is attacked)
[facility.defense]
armor = 100                  # Facility HP in base defense missions
flammable = false            # Cannot catch fire
explosive = false            # Doesn't explode when destroyed
capture_value = "high"       # Enemies prioritize capturing this facility

# Destruction consequences
[facility.destruction]
rebuild_cost_multiplier = 0.7    # Rebuilding costs 70% of original
data_loss = true                 # Lose research progress
evacuation_required = true       # Staff must evacuate
explosion_radius = 0             # No explosion

# Visual representation
[facility.visuals]
sprite_ground = "assets/facilities/lab_ground.png"     # Ground level view
sprite_underground = "assets/facilities/lab_under.png"  # Underground view
icon = "assets/icons/lab.png"                          # 20Ã—20 icon
construction_animation = "construct_lab"
active_animation = "lab_active"                        # Lights, activity
idle_animation = "lab_idle"

# Sound effects
[facility.audio]
ambient_sound = "sfx/lab_ambient.ogg"    # Background hum
construction_sound = "sfx/construction.ogg"
destruction_sound = "sfx/explosion_small.ogg"

# Special mechanics
[facility.special]
# Alien containment provides live specimens for research
provides_live_specimens = true

# Research conducted here has special properties
research_allows_live_autopsy = true

# Scientists assigned here gain experience faster
scientist_experience_multiplier = 1.5

# Unlocks special research projects
unlocks_research = ["alien_interrogation", "psionic_research"]

# Event triggers
[[facility.events]]
event_id = "containment_breach"
description = "Alien specimen escapes containment"
chance_per_month = 0.02      # 2% chance per month
trigger_condition = "contains_live_aliens"
consequences = [
    { type = "spawn_mission", mission = "base_defense_containment" },
    { type = "lose_specimen", count = 1 },
    { type = "damage_facility", damage = 20 }
]

[[facility.events]]
event_id = "research_breakthrough"
description = "Scientists make unexpected discovery"
chance_per_month = 0.10      # 10% chance per month
trigger_condition = "active_research"
consequences = [
    { type = "reduce_research_time", amount = 0.15 },
    { type = "unlock_bonus_research", research = "alien_physics_insights" }
]

# AI base building priority
[facility.ai_priority]
build_priority = 75          # 0-100, how much AI values this
prerequisite_priority = 90   # Higher because it unlocks research
strategic_value = 85         # Overall strategic assessment

# Capacity management
[facility.capacity]
max_active_projects = 3      # Can work on 3 research projects simultaneously
queue_size = 10              # Can queue up to 10 projects
shared_equipment = true      # Scientists can share equipment (efficiency bonus)

# Integration with other systems
[facility.integrations]
# Economy system
provides_income = false
can_manufacture = false

# Geoscape system
provides_radar_coverage = false
provides_defense_bonus = false

# Organization system
improves_reputation = true   # Having advanced research improves global reputation
reputation_bonus = 5

# Modding support
[facility.modding]
mod_id = "base_game"
author = "AlienFall Team"
version = "1.0.0"
override_priority = 100
tags = ["research", "laboratory", "containment", "advanced", "mid_game"]

# Balance notes
[facility.modding.balance_notes]
note = """
The Advanced Laboratory is the tier 2 research facility, providing significant
research speed improvements and unlocking specialized research paths.

Key balance points:
- 25% efficiency bonus is substantial but justified by 75K credit cost
- 12 scientist capacity allows mid-game research scaling
- Containment feature enables interrogation research path
- 14-day build time prevents instant power spike

If modding:
- Reducing cost should reduce efficiency bonus proportionally
- Increasing capacity should increase power consumption
- Adding more services should increase maintenance costs
- Consider adjacency requirements for game balance
"""

# Deterministic RNG scopes
[facility.rng_scopes]
events = "facility:advanced_lab:events"
containment = "facility:advanced_lab:containment"
breakthroughs = "facility:advanced_lab:breakthrough"
